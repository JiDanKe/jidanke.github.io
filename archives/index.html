<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>å½™æ•´ | JiDanKe</title>
  <meta name="author" content="JiDanKe">
  
  <meta name="description" content="JiDanKe&#39;s Blog">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="JiDanKe"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="JiDanKe" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">JiDanKe</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title">å½™æ•´</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-01T09:38:16.000Z"><a href="/2015/09/01/ulua-useage/">Sep 1 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/01/ulua-useage/">uLuaçš„ä½¿ç”¨</a></h1>
  

    </header>
    <div class="entry">
      
        <p>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æƒ³åœ¨luaè„šæœ¬ä¸­è°ƒç”¨LevelManageræ¥åˆ‡æ¢å…³å¡ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š<br>1.åœ¨BindLua.csä¸­æ·»åŠ LevelManager</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">static BindType[] binds = new BindType[]</span><br><span class="line">&#123;</span><br><span class="line">    //<span class="keyword">...</span></span><br><span class="line">    _GT(typeof(LevelManager)),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.ç­‰Unity3dç¼–è¯‘å®Œä¿®æ”¹åï¼Œåœ¨Luaèœå•ä¸­ç‚¹å‡»â€Gen Lua Wrap Filesâ€</p>
<p><img src="/images/caf73540883f62eef3d2c5e24f5dfa4deaaf2bc9" alt="ç”ŸæˆWrapæ–‡ä»¶"></p>
<p>3.Luaè„šæœ¬ä¸­å¼•ç”¨</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import <span class="string">"LevelManager"</span></span><br><span class="line"></span><br><span class="line">local levelMgr = LevelManager<span class="class">.Instance</span></span><br><span class="line">local nextLevel = levelMgr:<span class="function"><span class="title">GetNextLevel</span><span class="params">()</span></span></span><br><span class="line">levelMgr:<span class="function"><span class="title">LoadLevel</span><span class="params">(nextLevel)</span></span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-24T06:15:00.000Z"><a href="/2015/08/24/PureMVC-in-Unity-GUI/">Aug 24 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/08/24/PureMVC-in-Unity-GUI/">åœ¨ Unity çš„ GUI ä¸­ä½¿ç”¨ PureMVC</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="PureMVC">PureMVC</h1><p>PureMVC æ˜¯ä¸€ä¸ªè½»é‡çº§çš„åº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¸®åŠ©å¼€å‘è€…å®ç° MVCï¼ˆæ¨¡å‹ã€è§†å›¾ã€æ§åˆ¶å™¨ï¼‰ æ¨¡å¼ã€‚PureMVC æ¡†æ¶æœ€åˆæ˜¯ä¸º ActionScript å¼€å‘çš„ï¼Œç°åœ¨å·²ç»å‘å±•å‡ºäº†å„ç§è¯­è¨€çš„ç‰ˆæœ¬ï¼Œè¿™å…¶ä¸­ä¹ŸåŒ…æ‹¬ C# ç‰ˆæœ¬ï¼Œè¿™å°±æ„å‘³å¯ä»¥æŠŠè¿™ä¸ªæ¡†æ¶åº”ç”¨åˆ° Unity çš„æ¸¸æˆå¼€å‘ä¸­ã€‚</p>
<h2 id="PureMVC_çš„åŸºæœ¬ç»„ä»¶">PureMVC çš„åŸºæœ¬ç»„ä»¶</h2><p>åœ¨ PureMVC ä¸­æä¾›äº†ä¸‹é¢4ç§ç»„ä»¶ä¾›å¼€å‘è€…ä½¿ç”¨ï¼š</p>
<ol>
<li>Proxyã€‚Proxy å¯¹åº”äº MVC ä¸­çš„ Mï¼Œä½†æ˜¯å®ƒä¸æ˜¯çœŸæ­£çš„ Modelï¼Œåœ¨ PureMVC ä¸­æˆ‘ä»¬æ˜¯é€šè¿‡ Proxy å¯¹è±¡å»ä½¿ç”¨ Modelï¼Œè¿™ä¹Ÿå°±ä¿è¯äº† Model çš„ç‹¬ç«‹æ€§ã€‚</li>
<li>Meditorã€‚Meditor å¯¹åº”äº MVC ä¸­çš„ Vï¼Œ åŒæ ·å®ƒä¹Ÿä¸æ˜¯çœŸæ­£çš„ Viewï¼Œè€Œæ˜¯é€šè¿‡å®ƒæ¥ä½¿ç”¨æˆ‘ä»¬äº‹å…ˆåˆ›å»ºå¥½çš„ä¸€äº›å…³äºè§†å›¾çš„ä¸€äº›æ¥å£ã€‚</li>
<li>Commandã€‚Cammand å°±æ˜¯ MVC ä¸­çš„ Cï¼Œåœ¨ Command é‡Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ Proxy å»å’Œ Model è¿›è¡Œäº¤äº’ï¼Œå¤§å¤šæ•°ä¸šåŠ¡é€»è¾‘éƒ½åº”è¯¥åœ¨ Cammand é‡Œå®Œæˆã€‚Command æ˜¯æ— çŠ¶æ€çš„ï¼Œä»–å’Œå…¶ä»–çš„ Command å’Œ Meditor ä¹‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡é€šçŸ¥ï¼ˆNotificationï¼‰çš„æ–¹å¼æ¥è¿›è¡Œã€‚</li>
<li>Facadeã€‚è¿™å¯èƒ½æ˜¯ PureMVC ä¸­æœ€é‡è¦çš„ä¸€ä¸ªç»„ä»¶äº†ï¼Œæˆ‘ä»¬è¦é€šè¿‡å®ƒæ¥åˆå§‹åŒ– Proxyã€ Meditorã€Command ä»¥åŠç»‘å®šä»–ä»¬å’Œå¯¹åº”çš„é€šçŸ¥ä¹‹é—´çš„å…³ç³»ã€‚</li>
</ol>
<h1 id="åœ¨_Unity_ä¸­ä½¿ç”¨_PureMVC">åœ¨ Unity ä¸­ä½¿ç”¨ PureMVC</h1><p>åœ¨ç½‘ä¸Šçš„å¹¶æ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒå¥½çš„ PureMVC C# çš„æ•™ç¨‹ï¼Œå®˜æ–¹çš„æ–‡æ¡£ä¹Ÿååˆ†æœ‰é™ï¼Œæ‰€ä»¥å°±å‚è€ƒäº†ä¸€ä¸ª Java ç‰ˆçš„æ•™ç¨‹åšäº†ä¸‹é¢çš„ä¾‹å­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ä¸»è¦å…³æ³¨ GUI ï¼Œè€Œä¸æ˜¯æ¸¸æˆé€»è¾‘ã€‚ä¾‹å­çš„å†…å®¹å¾ˆç®€å•ï¼šç‚¹å‡»æŒ‰é’®ä¹‹åï¼Œåœ¨ Label ä¸­æ˜¾ç¤º â€œHello World!â€ è¿™å¥è¯ã€‚</p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2015/08/24/PureMVC-in-Unity-GUI/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-19T06:15:00.000Z"><a href="/2015/08/19/texture-mapping-and-render-pipeline/">Aug 19 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/08/19/texture-mapping-and-render-pipeline/">ä» Texture Maping ç†è§£å¯ç¼–ç¨‹çš„å›¾å½¢ç®¡çº¿</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Texture_Mapping">Texture Mapping</h1><p>åœ¨ Unity 3D å¼•æ“ä¸­è¦æ¸²æŸ“ä¸€ä¸ª3Dæ¨¡å‹éœ€è¦è¿™æ ·ä¸€äº›åŸºæœ¬ç»„ä»¶ï¼š<code>Mesh</code>ã€<code>Material</code>å’Œ<code>Shader</code>ã€‚å…¶ä¸­<code>Mesh</code>èƒ½å¤Ÿè¡¨ç¤ºæ¨¡å‹çš„å‡ ä½•å½¢çŠ¶ï¼Œåœ¨æœ‰äº†æ¨¡å‹çš„å‡ ä½•å½¢çŠ¶ä¹‹åæ¸¸æˆå¼•æ“å°±å¯ä»¥æŠŠ<code>Material</code>æ¸²æŸ“åˆ°æ¨¡å‹è¡¨é¢ã€‚<code>Material</code>çš„è¡¨ç°æ•ˆæœåˆ™å¯ä»¥ç”±ç€è‰²å™¨ä¹Ÿå°±æ˜¯<code>Shader</code>æ¥æ§åˆ¶ã€‚</p>
<p>å¦‚æœæ¨¡å‹è¡¨é¢åªéœ€è¦æ¸²æŸ“çº¯è‰²ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€åœ¨ç€è‰²å™¨ä¸­å¾—çš„å—ä½œè‰²å™¨ï¼ˆfragment shaderï¼‰ä¸­è¿”å›æ¨¡å‹è¡¨é¢æ¯ä¸ªåƒç´ ç‚¹éœ€è¦çš„é¢œè‰²å³å¯ï¼›ä½†æ˜¯å¦‚æœæƒ³è¦æŠŠäº‹å…ˆåˆ¶ä½œå¥½çš„å›¾ç‰‡ï¼ˆä¹Ÿå°±æ˜¯è´´å›¾ï¼‰æ¸²æŸ“åˆ°æ¨¡å‹ä¸Šå°±è¦ç›¸å¯¹å¤æ‚ä¸€äº›ï¼Œå› ä¸ºæ¨¡å‹è¡¨é¢æ¯ä¸ªåƒç´ ç‚¹çš„é¢œè‰²æˆ‘ä»¬éœ€è¦ä»è´´å›¾ä¸Šè·å–ï¼Œè¦å‡†ç¡®åœ°è·å–åˆ°é¢œè‰²å¿…é¡»è¦æŠŠæ¨¡å‹è¡¨é¢çš„åƒç´ ç‚¹å’Œè´´å›¾ä¸Šçš„åƒç´ ç‚¹å¯¹åº”èµ·æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åš Texture Mappingã€‚</p>
<p>åœ¨ç€è‰²å™¨çš„å±‚é¢ä¸Š Texture Mapping å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªç®€å•çš„ä½œè‰²å™¨è¡¨ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">"Cg shader with single texture"</span> &#123;</span><br><span class="line">   Properties &#123;</span><br><span class="line">      _MainTex (<span class="string">"Texture Image"</span>, <span class="number">2</span>D) = <span class="string">"white"</span> &#123;&#125; </span><br><span class="line">         <span class="comment">// è¦ç”¨æ¥æ¸²æŸ“æ¨¡å‹çš„è´´å›¾</span></span><br><span class="line">   &#125;</span><br><span class="line">   SubShader &#123;</span><br><span class="line">      Pass &#123;    </span><br><span class="line">         CGPROGRAM</span><br><span class="line"> </span><br><span class="line">         <span class="preprocessor">#<span class="keyword">pragma</span> vertex vert  </span></span><br><span class="line">         <span class="preprocessor">#<span class="keyword">pragma</span> fragment frag </span></span><br><span class="line"> </span><br><span class="line">         uniform sampler2D _MainTex;    </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">struct</span> vertexInput &#123;</span><br><span class="line">            float4 vertex : POSITION;</span><br><span class="line">            float4 texcoord : TEXCOORD0;</span><br><span class="line">         &#125;;</span><br><span class="line">         <span class="keyword">struct</span> vertexOutput &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            float4 tex : TEXCOORD0;</span><br><span class="line">         &#125;;</span><br><span class="line"> </span><br><span class="line">         <span class="function">vertexOutput <span class="title">vert</span><span class="params">(vertexInput input)</span> </span><br><span class="line">         </span>&#123;</span><br><span class="line">            vertexOutput output;</span><br><span class="line"> </span><br><span class="line">            output.tex = input.texcoord;</span><br><span class="line">               <span class="comment">// é¡¶ç‚¹åœ¨è´´å›¾åæ ‡çš„åæ ‡ï¼Œä¹Ÿå°±æ˜¯ UV åæ ‡ </span></span><br><span class="line">			   </span><br><span class="line">            output.pos = mul(UNITY_MATRIX_MVP, input.vertex);</span><br><span class="line">            <span class="keyword">return</span> output;</span><br><span class="line">         &#125;</span><br><span class="line">		 </span><br><span class="line">         <span class="function">float4 <span class="title">frag</span><span class="params">(vertexOutput input)</span> : COLOR</span><br><span class="line">         </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> tex2D(_MainTex, input.tex.xy);   </span><br><span class="line">               <span class="comment">// æ ¹æ®æ¨¡å‹è¡¨é¢åƒç´ ç‚¹çš„ UV åæ ‡è·å–è´´å›¾ä¸Šçš„é¢œè‰²è¿›è¡Œæ¸²æŸ“</span></span><br><span class="line">         &#125;</span><br><span class="line"> </span><br><span class="line">         ENDCG</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­æˆ‘ä»¬åªæ˜¯è¾“å…¥äº†é¡¶ç‚¹çš„ UV åæ ‡ï¼Œä½†æ˜¯åœ¨å—ç€è‰²å™¨ä¸­å´å¯ä»¥é€šè¿‡æ¨¡å‹è¡¨é¢åƒç´ ç‚¹çš„ UV åæ ‡æ¥è·å–äº†è´´å›¾ä¸Šé¢œè‰²ï¼Œè‡³äºè¿™äº›åƒç´ ç‚¹çš„ UV åæ ‡ä»ä½•è€Œæ¥æˆ‘ä»¬ä»ä»£ç ä¸Šæ˜¯çœ‹ä¸å‡ºæ¥çš„ã€‚åŸå› æ˜¯æ¨¡å‹è¡¨é¢åƒç´ ç‚¹çš„ UV  åæ ‡çš„ç¡®å®šå¹¶ä¸æ˜¯é€šè¿‡åœ¨ç€è‰²å™¨ä¸­ç¼–ç¨‹å®ç°çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±å›¾å½¢ç®¡çº¿è‡ªåŠ¨çš„å®Œæˆçš„ã€‚é‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å®Œæˆçš„å‘¢ï¼Ÿè¿™å°±éœ€è¦å»äº†è§£ä¸€ä¸‹å…³äºå›¾å½¢ç®¡çº¿ï¼ˆGraphics Pipelineï¼‰çš„ç›¸å…³çŸ¥è¯†äº†ã€‚</p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2015/08/19/texture-mapping-and-render-pipeline/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-12T09:50:57.000Z"><a href="/2015/08/12/Change-size-of-the-new-Unity-UI-RectTransform/">Aug 12 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/08/12/Change-size-of-the-new-Unity-UI-RectTransform/">Change size of the new Unity UI RectTransform</a></h1>
  

    </header>
    <div class="entry">
      
        <p>æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‘ç°ï¼Œè¦è°ƒæ•´Unity UIå…ƒç´ çš„å¤§å°ï¼ŒRectTransformæä¾›äº†sizeDeltaå±æ€§å¯ä»¥ç”¨æ¥åŠ¨æ€ä¿®æ”¹RectTransformçš„å¤§å°ï¼Œä½†åŒæ—¶æˆ‘ä»¬ä¹Ÿgoogleåˆ°å¦å¤–ä¸€ä¸ªä¿®æ”¹RectTransformå¤§å°çš„æ–¹æ³•ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetRectTransformSize</span><span class="params">(RectTransform trans, Vector2 newSize)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    Vector2 oldSize = trans.rect.size;</span><br><span class="line">    Vector2 deltaSize = newSize - oldSize;</span><br><span class="line">    trans.offsetMin = trans.offsetMin - <span class="keyword">new</span> Vector2(deltaSize.x * trans.pivot.x, deltaSize.y * trans.pivot.y);</span><br><span class="line">    trans.offsetMax = trans.offsetMax + <span class="keyword">new</span> Vector2(deltaSize.x * (<span class="number">1</span>f - trans.pivot.x), deltaSize.y * (<span class="number">1</span>f - trans.pivot.y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‚£RectTransform.sizeDeltaå’Œè¿™ä¸ªè‡ªå®šä¹‰çš„SetRectTransformSizeæœ‰æ²¡æœ‰å·®åˆ«ï¼Ÿå·®åˆ«åœ¨å“ªå„¿ï¼Ÿæˆ‘ä»¬åšäº†ä¸‹å®éªŒæ¥æµ‹è¯•ï¼š<br>æ–°å»ºä¸€ä¸ªåœºæ™¯ï¼Œæ”¾å…¥å››ä¸ªæŒ‰é’®<br><img src="/images/1c74b2bca5f5c0036b0378fcd32e344e5c566cfe" alt=""></p>
<p>å…¶ä¸­deltaSizeå’ŒresizeæŒ‰é’®çš„Anchorså››ä¸ªç‚¹é‡åˆï¼ŒdeltaSizeWithCustomAncå’ŒresizeWithCustomAncæŒ‰é’®çš„å››ä¸ªç‚¹ä¸é‡åˆ<br><img src="/images/5d9d8a46a44dc8fb4ee9c19834300b129922d7f3" alt=""></p>
<p><img src="/images/84092fd5bf56e4fa4b9cfbbe454b41180cacf693" alt=""></p>
<p>ç„¶åæŒ‚è½½ä¸€ä¸ªè„šæœ¬ï¼Œåœ¨ç‚¹å‡»changeæŒ‰é’®çš„æ—¶å€™ä¿®æ”¹ä¸Šè¾¹å››ä¸ªæŒ‰é’®çš„å¤§å°ï¼š<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ResizeTestController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RectTransform deltaSizeBtn;</span><br><span class="line">    <span class="keyword">public</span> RectTransform resizeBtn;</span><br><span class="line">    <span class="keyword">public</span> RectTransform deltaSizeDiffAncBtn;</span><br><span class="line">    <span class="keyword">public</span> RectTransform resizeDiffAncBtn;</span><br><span class="line"></span><br><span class="line">    Vector2 newSize =<span class="keyword">new</span> Vector2(<span class="number">300</span>f,<span class="number">50</span>f);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Change</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//Anchorsåœ¨åŒä¸€ç‚¹çš„button</span></span><br><span class="line">        deltaSizeBtn.sizeDelta = newSize;</span><br><span class="line">        U3DUtils.SetRectTransformSize(resizeBtn, newSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Anchorsä¸åœ¨åŒä¸€ç‚¹çš„button</span></span><br><span class="line">        deltaSizeDiffAncBtn.sizeDelta = newSize;</span><br><span class="line">        U3DUtils.SetRectTransformSize(resizeDiffAncBtn, newSize);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç‚¹å‡»ChangeæŒ‰é’®åï¼š<br><img src="/images/9bd9957157cb1c2e129b7d742347e66f3011ca3f" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŒ‰é’®deltaSizeWithCustomAncçš„å¤§å°ä¸ä¼—ä¸åŒï¼Œè¯´æ˜sizeDeltaå±æ€§çš„è®¡ç®—è¿‡ç¨‹è·ŸSetRectTransformSizeæ˜¯ä¸ä¸€æ ·çš„ï¼ŒUnityå®˜æ–¹æ–‡æ¡£å¯¹sizeDeltaçš„è¯´æ˜ï¼š<br><a href="http://docs.unity3d.com/462/Documentation/ScriptReference/RectTransform-sizeDelta.html" target="_blank" rel="external">RectTransform sizeDelta</a><br>å¤§æ¦‚æ„æ€æ˜¯Anchorsåœ¨åŒä¸€ç‚¹çš„æ—¶å€™ï¼ŒsizeDeltaç›¸å½“äºè®¾ç½®é•¿å®½ï¼Œä½†æ˜¯Anchorsä¸åœ¨åŒä¸€ç‚¹æ—¶ï¼Œè¡¨ç¤ºçš„åªæ˜¯æ¯”AnchorsçŸ©å½¢å¤§æˆ–è€…å°å¤šå°‘ã€‚</p>
<p>é‚£ä¹ˆsizeDeltaå…·ä½“åˆæ˜¯æ€ä¹ˆè½¬æ¢åˆ°trans.offsetMinå’Œtrans.offsetMaxçš„å‘¢ï¼Ÿ<br><img src="/images/a372fb5139afc590951dc9ff6c6d38496b1cba11" alt=""><br>å¦‚ä¸Šå›¾ï¼Œleft  + rightåˆšå¥½æ˜¯æˆ‘ä»¬è®¾ç½®çš„300çš„-1å€ï¼š-300, top + bottomä¹Ÿæ˜¯åˆšå¥½-50ï¼ˆè´Ÿæ•°çš„æ„æ€æ˜¯æ¯”AnchorsçŸ©å½¢å¤§ï¼›æ­£æ•°å°±æ˜¯AnchorsçŸ©å½¢å†…ï¼Œå°±æ˜¯æ¯”AnchrosçŸ©å½¢å°ï¼‰ã€‚<br>é‚£å¯ä»¥çŒœæµ‹ï¼ˆçœ‹æºä»£ç æ²¡æ‰¾åˆ°sizeDeltaæœ€ç»ˆè®¡ç®—çš„åœ°æ–¹ï¼ŒğŸ˜“ï¼‰sizeDeltaçš„è®¡ç®—æ–¹æ³•æ˜¯ä¸anchorsæœ‰å…³çš„ï¼Œå½“ç„¶è¿˜ä¸Pivotæœ‰å…³ï¼ˆå¯ä»¥è‡ªå·±æµ‹è¯•ä¸‹çœ‹çœ‹ï¼‰ï¼Œå†™ä¸ªæ¨¡æ‹Ÿæ–¹æ³•æ¥éªŒè¯ä¸‹ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetRectTransformDeltaSize</span><span class="params">(RectTransform trans, Vector2 newSize)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = -newSize.x - trans.offsetMin.x + trans.offsetMax.x;</span><br><span class="line">    <span class="keyword">var</span> y = -newSize.y - trans.offsetMin.y + trans.offsetMax.y;</span><br><span class="line"></span><br><span class="line">    trans.offsetMin = <span class="keyword">new</span> Vector2( trans.offsetMin.x + trans.pivot.x * x, trans.offsetMin.y + trans.pivot.y * y);</span><br><span class="line">    trans.offsetMax = <span class="keyword">new</span> Vector2( -(-trans.offsetMax.x + (<span class="number">1</span>-trans.pivot.x) * x),-(-trans.offsetMax.y + (<span class="number">1</span>-trans.pivot.y) * y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥çœ‹å¯èƒ½ä¸å®¹æ˜“æ˜ç™½æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä¸è¿‡æ ¹æ®Unityçš„æ–‡æ¡£æˆ‘ä»¬çŸ¥é“sizeDeltaè¡¨ç¤ºçš„æ˜¯RectTransformdå¯¹è±¡çŸ©å½¢å¤§å°æ¯”PivotçŸ©å½¢å¤§æˆ–è€…å°å¤šå°‘ï¼Œé‚£ä¹ˆRectTransformçš„Leftå’ŒRightä¹‹å’Œå°±ç­‰äºsizeDelta.xçš„-1å€ï¼Œå†è€ƒè™‘pivotï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªè®¡ç®—å…¬å¼:<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(Left + pivot.x *X)</span> + <span class="comment">(Right + (1-pivot.x)</span> * X) =  - sizeDelta.x</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­Xæ˜¯è¦æ±‚å‡ºçš„å˜é‡ï¼Œè½¬æ¢ä¸‹å…¬å¼å°±æ˜¯ï¼š<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X =  - sizeDelta.x - <span class="keyword">Left</span> - <span class="keyword">Right</span></span><br></pre></td></tr></table></figure></p>
<p>ç”±äº<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Left == trans<span class="class">.offsetMin</span><span class="class">.x</span></span><br><span class="line">Right == - trans<span class="class">.offsetMax</span><span class="class">.x</span></span><br></pre></td></tr></table></figure></p>
<p>å¸¦å…¥å<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X =  - sizeDelta<span class="class">.x</span> - trans<span class="class">.offsetMin</span><span class="class">.x</span> - (- trans<span class="class">.offsetMax</span><span class="class">.x</span>)</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆæ–°çš„Leftå°±æ˜¯<br>Left + pivot.x <em>X<br>æ–°çš„Rightå°±æ˜¯<br>Right + (1-pivot.x) </em> X<br>Rightè½¬å›offsetMax.xxéœ€è¦*-1</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-07-07T12:39:12.000Z"><a href="/2015/07/07/uGUI-AugoLayout/">Jul 7 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/07/07/uGUI-AugoLayout/">uGUIä¹‹AutoLayoutè¯¦è§£â€”â€”minHeight,preferredHeight,flexibleHeight</a></h1>
  

    </header>
    <div class="entry">
      
        <p>é¦–å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼Œæ–°å»ºä¸€ä¸ªPanelï¼Œåœ¨ä¸‹é¢æ·»åŠ ä¸¤ä¸ªButtonï¼Œåˆ†åˆ«å‘½åä¸ºButtonã€Button2ã€‚<br>1ã€ç»™Panelæ·»åŠ ä¸€ä¸ªVerticalLayoutGroupç»„ä»¶ï¼ŒChildForceExpandå±æ€§ä¸­å‹¾ä¸ŠWidthã€‚<br>2ã€ç»™Buttonã€Button2æ·»åŠ LayoutElementç»„ä»¶ï¼Œå…¶ä¸­Buttonçš„FlexibleHeightè®¾ç½®ä¸º0.3ï¼ŒButton2çš„FlexibleHeightè®¾ç½®ä¸º0.1<br>3ã€å°†Panelçš„é«˜åº¦è®¾ç½®ä¸º100</p>
<p><img src="/images/cc7b7acff95f50dacd518d7fc8858ce81361114b.png" alt="1-1"></p>
<p><img src="/images/fb0e7991d0ed8d5cb82b8f80489162b29ddbb225.png" alt="1-2"></p>
<p>è¿™æ—¶æˆ‘ä»¬å‘ç°ï¼ŒButtonçš„é«˜åº¦æ˜¯70ï¼ŒButton2çš„é«˜åº¦æ˜¯30ã€‚å¥‡æ€ªï¼Œè¿™ä¸ªé«˜åº¦æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„å‘¢ï¼Ÿ</p>
<p>ç½‘ä¸Šæœç´¢ä¸€ç•ªï¼Œç«Ÿç„¶å¾ˆå°‘æœ‰äººè®¨è®ºuGUIçš„AutoLayoutï¼Œå°¤å…¶æ˜¯flexibleWidth/Heightå±æ€§çš„æ„ä¹‰ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿè¯­ç„‰ä¸è¯¦ã€‚è¿™æ—¶åªèƒ½æ”¾å¤§æ‹›äº†ï¼ŒuGUIå·²ç»å¼€æºï¼Œç´¢æ€§æŠŠä»£ç æ‹‰ä¸‹æ¥çœ‹çœ‹åˆ°åº•æ€ä¹ˆå®ç°çš„ã€‚ä¸‹é¢æ˜¯æ‰˜ç®¡ä»£ç çš„åœ°å€ï¼š<br><a href="https://bitbucket.org/Unity-Technologies/ui" target="_blank" rel="external">https://bitbucket.org/Unity-Technologies/ui</a></p>
<p>uGUIçš„AutoLayoutæœ‰ä¸‰ä¸ªæ ¸å¿ƒæ¥å£ï¼Œå®šä¹‰åœ¨ILayoutElement.csæ–‡ä»¶ä¸­ï¼š<br>ILayoutElement<br>ILayoutController<br>ILayoutIgnorer</p>
<p>ç»“æ„å¾ˆæ¸…æ™°ï¼Œç”±ILayoutElementæä¾›å¸ƒå±€ä¿¡æ¯ï¼ŒILayoutControlleræ¥æ§åˆ¶å¸ƒå±€ï¼ŒILayoutIgnoreæä¾›ç»™UIå¿½ç•¥AutoLayoutçš„èƒ½åŠ›ã€‚</p>
<p>ä¾‹å­ä¸­ä½¿ç”¨çš„VerticalLayoutGroupç»§æ‰¿è‡ªHorizontalOrVerticalLayoutGroupï¼Œè¿™ä¸ªç±»å®ç°äº†å¸ƒå±€çš„æ ¸å¿ƒé€»è¾‘ï¼Œä»£ç é‡ä¸å¤šï¼Œæˆ‘å°±ç›´æ¥è´´ä¸Šæ¥äº†<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">protected void CalcAlongAxis(int axis, bool isVertical)</span><br><span class="line">&#123;</span><br><span class="line">    float <span class="variable">combinedPadding =</span> (<span class="variable">axis =</span>= <span class="number">0</span> ? padding.horizontal : padding.vertical);</span><br><span class="line"></span><br><span class="line">    float <span class="variable">totalMin =</span> combinedPadding;</span><br><span class="line">    float <span class="variable">totalPreferred =</span> combinedPadding;</span><br><span class="line">    float <span class="variable">totalFlexible =</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    bool <span class="variable">alongOtherAxis =</span> (isVertical ^ (<span class="variable">axis =</span>= <span class="number">1</span>));</span><br><span class="line">    for (int <span class="variable">i =</span> <span class="number">0</span>; i &lt; rectChildren.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        RectTransform <span class="variable">child =</span> rectChildren[i];</span><br><span class="line">        float <span class="variable">min =</span> LayoutUtility.GetMinSize(child, axis);</span><br><span class="line">        float <span class="variable">preferred =</span> LayoutUtility.GetPreferredSize(child, axis);</span><br><span class="line">        float <span class="variable">flexible =</span> LayoutUtility.GetFlexibleSize(child, axis);</span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">axis =</span>= <span class="number">0</span> ? childForceExpandWidth : childForceExpandHeight))</span><br><span class="line">            <span class="variable">flexible =</span> Mathf.Max(flexible, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (alongOtherAxis)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">totalMin =</span> Mathf.Max(min + combinedPadding, totalMin);</span><br><span class="line">            <span class="variable">totalPreferred =</span> Mathf.Max(preferred + combinedPadding, totalPreferred);</span><br><span class="line">            <span class="variable">totalFlexible =</span> Mathf.Max(flexible, totalFlexible);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            totalMin += min + spacing;</span><br><span class="line">            totalPreferred += preferred + spacing;</span><br><span class="line"></span><br><span class="line">            // Increment flexible size <span class="keyword">with</span> element's flexible size.</span><br><span class="line">            totalFlexible += flexible;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!alongOtherAxis &amp;&amp; rectChildren.Count &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        totalMin <span class="variable">-=</span> spacing;</span><br><span class="line">        totalPreferred <span class="variable">-=</span> spacing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">totalPreferred =</span> Mathf.Max(totalMin, totalPreferred);</span><br><span class="line">    SetLayoutInputForAxis(totalMin, totalPreferred, totalFlexible, axis);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected void SetChildrenAlongAxis(int axis, bool isVertical)</span><br><span class="line">&#123;</span><br><span class="line">    float <span class="variable">size =</span> rectTransform.rect.size[axis];</span><br><span class="line"></span><br><span class="line">    bool <span class="variable">alongOtherAxis =</span> (isVertical ^ (<span class="variable">axis =</span>= <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">if</span> (alongOtherAxis)</span><br><span class="line">    &#123;</span><br><span class="line">        float <span class="variable">innerSize =</span> size - (<span class="variable">axis =</span>= <span class="number">0</span> ? padding.horizontal : padding.vertical);</span><br><span class="line">        for (int <span class="variable">i =</span> <span class="number">0</span>; i &lt; rectChildren.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            RectTransform <span class="variable">child =</span> rectChildren[i];</span><br><span class="line">            float <span class="variable">min =</span> LayoutUtility.GetMinSize(child, axis);</span><br><span class="line">            float <span class="variable">preferred =</span> LayoutUtility.GetPreferredSize(child, axis);</span><br><span class="line">            float <span class="variable">flexible =</span> LayoutUtility.GetFlexibleSize(child, axis);</span><br><span class="line">            <span class="keyword">if</span> ((<span class="variable">axis =</span>= <span class="number">0</span> ? childForceExpandWidth : childForceExpandHeight))</span><br><span class="line">                <span class="variable">flexible =</span> Mathf.Max(flexible, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            float <span class="variable">requiredSpace =</span> Mathf.Clamp(innerSize, min, flexible &gt; <span class="number">0</span> ? size : preferred);</span><br><span class="line">            float <span class="variable">startOffset =</span> GetStartOffset(axis, requiredSpace);</span><br><span class="line">            SetChildAlongAxis(child, axis, startOffset, requiredSpace);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        float <span class="variable">pos =</span> (<span class="variable">axis =</span>= <span class="number">0</span> ? padding.left : padding.top);</span><br><span class="line">        <span class="keyword">if</span> (GetTotalFlexibleSize(axis) == <span class="number">0</span> &amp;&amp; GetTotalPreferredSize(axis) &lt; size)</span><br><span class="line">            <span class="variable">pos =</span> GetStartOffset(axis, GetTotalPreferredSize(axis) - (<span class="variable">axis =</span>= <span class="number">0</span> ? padding.horizontal : padding.vertical));</span><br><span class="line"></span><br><span class="line">        float <span class="variable">minMaxLerp =</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (GetTotalMinSize(axis) != GetTotalPreferredSize(axis))</span><br><span class="line">            <span class="variable">minMaxLerp =</span> Mathf.Clamp01((size - GetTotalMinSize(axis)) / (GetTotalPreferredSize(axis) - GetTotalMinSize(axis)));</span><br><span class="line"></span><br><span class="line">        float <span class="variable">itemFlexibleMultiplier =</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (size &gt; GetTotalPreferredSize(axis))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (GetTotalFlexibleSize(axis) &gt; <span class="number">0</span>)</span><br><span class="line">                <span class="variable">itemFlexibleMultiplier =</span> (size - GetTotalPreferredSize(axis)) / GetTotalFlexibleSize(axis);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for (int <span class="variable">i =</span> <span class="number">0</span>; i &lt; rectChildren.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            RectTransform <span class="variable">child =</span> rectChildren[i];</span><br><span class="line">            float <span class="variable">min =</span> LayoutUtility.GetMinSize(child, axis);</span><br><span class="line">            float <span class="variable">preferred =</span> LayoutUtility.GetPreferredSize(child, axis);</span><br><span class="line">            float <span class="variable">flexible =</span> LayoutUtility.GetFlexibleSize(child, axis);</span><br><span class="line">            <span class="keyword">if</span> ((<span class="variable">axis =</span>= <span class="number">0</span> ? childForceExpandWidth : childForceExpandHeight))</span><br><span class="line">                <span class="variable">flexible =</span> Mathf.Max(flexible, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            float <span class="variable">childSize =</span> Mathf.Lerp(min, preferred, minMaxLerp);</span><br><span class="line">            childSize += flexible * itemFlexibleMultiplier;</span><br><span class="line">            SetChildAlongAxis(child, axis, pos, childSize);</span><br><span class="line">            pos += childSize + spacing;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­SetChildrenAlongAxisæ–¹æ³•æ¸…æ™°åœ°é˜é‡Šäº†minHeight,preferredHeight,flexibleHeightçš„æ¶µä¹‰ã€‚</p>
<p>ä¸ºäº†å¸®åŠ©ç†è§£ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å‡ ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬æŠŠå½“å‰UIæ‰€æœ‰åŒçº§å¹¶å‚ä¸è‡ªåŠ¨å¸ƒå±€çš„ç»„ä»¶çš„preferredHeightæ€»å’Œç§°ä¸ºtotalPreferredHeightï¼ŒminHeightçš„æ€»å’Œç§°ä¸ºtotalMinHeightï¼Œçˆ¶UIçš„çœŸå®é«˜åº¦ç§°ä¸ºrealHeightã€‚æ€»ç»“å¦‚ä¸‹ï¼š</p>
<p>1ã€<strong>minHeight</strong><br>åœ¨è‡ªåŠ¨å¸ƒå±€ä¸­ï¼Œæ­¤UIæœ€å°é«˜åº¦ä¸ä¼šå°äºminHeightã€‚è¿™ä¸ªå‚æ•°å®šä¹‰äº†realHeight &lt; totalMinHeightæ—¶ï¼Œå½“å‰å­UIçš„heightä¸ºminHeightã€‚</p>
<p>2ã€<strong>preferredHeight</strong><br>å¯ä»¥ç†è§£ä¸ºï¼ŒUIè‡ªèº«å¸Œæœ›çš„é«˜åº¦ã€‚<br>å½“totalMinHeight &lt; realHeight  &lt; totalPreferredHeightæ—¶ï¼ŒrealHeightå¤„äºtotalMinHeightå’ŒtotalPreferredHeightä¹‹é—´ä¸€å®šç™¾åˆ†æ¯”ï¼ŒæŠŠè¿™ä¸ªæ¯”ä¾‹åº”ç”¨åˆ°æ¯ä¸€ä¸ªæ¥å—è‡ªåŠ¨å¸ƒå±€çš„å­UIä¸Šï¼Œå³æ˜¯æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„æ•ˆæœ</p>
<p><img src="/images/b63ec5b54e3cbcd3e42717dbcd468d4b701fb090.png" alt="1-3"></p>
<p>3ã€<strong>flexibleHeight</strong><br>å½“realHeight &gt; totalPreferredHeightæ—¶ï¼Œçˆ¶UIä¼šå‰©ä¸‹ä¸€éƒ¨åˆ†é«˜åº¦ã€‚flexibleHeightå°±æ˜¯å‘Šè¯‰AutoLayoutç³»ç»Ÿï¼Œåº”è¯¥æ€ä¹ˆç“œåˆ†å‰©ä¸‹çš„é«˜åº¦ï¼Œä½¿å­UIå¡«å……æ»¡çˆ¶UIã€‚flexibleHeighté»˜è®¤æ˜¯-1ï¼Œä¸ä¼šè¿›è¡Œæ‰©å……ã€‚å½“flexibleHeight &gt; 0æ—¶ï¼ŒflexibleHeightå€¼ä½œä¸ºæƒé‡æ¥è®¡ç®—å½“å‰å­UIæœ€ç»ˆçš„é«˜åº¦ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>height = preferredHeight + (flexibleHeight / totalFlexibleHeight) * (realHeight - totalPreferredHeight)</p>
</blockquote>
<p><img src="/images/ccd93ef2ddc7b0e1bc7195b09cf19c115db9c635.png" alt="flexibleHeightç¤ºæ„å›¾"></p>
<p>å¼„æ¸…æ¥šè¿™äº›æ¦‚å¿µåï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ–‡ç« å¼€å¤´çš„ä¾‹å­ã€‚<br>button1çš„flexibleHeight=0.3ï¼Œbutton2çš„flexibleHeight=0.1ï¼ŒminHeightå’ŒpreferredHeightéƒ½æ²¡æœ‰è®¾ç½®ï¼ŒæŒ‰é“ç†é«˜åº¦åº”è¯¥åˆ†åˆ«æ˜¯75ã€25ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°70ã€30ï¼Ÿ</p>
<p>æŸ¥ä¸€ä¸‹ILayoutElementçš„å®ç°ç±»<br><img src="/images/662905a043156155048c7bc0a31350a03da13331.png" alt="ILayoutElementå®ç°ç±»"></p>
<p>å‘ç°Imageå’ŒTextå®ç°äº†ILayoutElementï¼Œè€Œæˆ‘ä»¬çš„æŒ‰é’®ä¸­é»˜è®¤æ˜¯æœ‰ä¸€ä¸ªImageç»„ä»¶çš„ï¼Œç”¨è„šæœ¬è·å–è¿™ä¸ªImageç„¶åæ‰“å°å®ƒçš„preferredHeightï¼Œå‘ç°ç­‰äº10<br>å†å¥—ç”¨flexibleHeightçš„è®¡ç®—å…¬å¼ï¼š<br>Button1:10 + 0.3/0.4 <em> (100 - 20) = 70<br>Button2:10 + 0.1/0.4 </em> (100 - 20) = 30</p>
<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªGameObjectä¸ŠæŒ‚è½½ä¸¤ä¸ªILayoutElementç»„ä»¶ï¼Œæ˜¯æ€ä¹ˆå†³å®šç”¨å“ªä¸ªçš„ï¼Ÿè¿™ä¸ªå¯ä»¥åœ¨LayoutUtility.csä¸­æ‰¾åˆ°ç­”æ¡ˆï¼š</p>
<p>LayoutUtility.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> <span class="title">GetLayoutProperty</span><span class="params">(RectTransform rect, System.Func&lt;ILayoutElement, <span class="keyword">float</span>&gt; property, <span class="keyword">float</span> defaultValue, <span class="keyword">out</span> ILayoutElement source)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    source = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (rect == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> min = defaultValue;</span><br><span class="line">    <span class="keyword">int</span> maxPriority = System.Int32.MinValue;</span><br><span class="line">    <span class="keyword">var</span> components = ComponentListPool.Get();</span><br><span class="line">    rect.GetComponents(<span class="keyword">typeof</span>(ILayoutElement), components);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; components.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> layoutComp = components[i] <span class="keyword">as</span> ILayoutElement;</span><br><span class="line">        <span class="keyword">if</span> (layoutComp <span class="keyword">is</span> Behaviour &amp;&amp; (!(layoutComp <span class="keyword">as</span> Behaviour).enabled || !(layoutComp <span class="keyword">as</span> Behaviour).isActiveAndEnabled))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> priority = layoutComp.layoutPriority;</span><br><span class="line">        <span class="comment">// If this layout components has lower priority than a previously used, ignore it.</span></span><br><span class="line">        <span class="keyword">if</span> (priority &lt; maxPriority)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">float</span> prop = property(layoutComp);</span><br><span class="line">        <span class="comment">// If this layout property is set to a negative value, it means it should be ignored.</span></span><br><span class="line">        <span class="keyword">if</span> (prop &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If this layout component has higher priority than all previous ones,</span></span><br><span class="line">        <span class="comment">// overwrite with this one's value.</span></span><br><span class="line">        <span class="keyword">if</span> (priority &gt; maxPriority)</span><br><span class="line">        &#123;</span><br><span class="line">            min = prop;</span><br><span class="line">            maxPriority = priority;</span><br><span class="line">            source = layoutComp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// If the layout component has the same priority as a previously used,</span></span><br><span class="line">        <span class="comment">// use the largest of the values with the same priority.</span></span><br><span class="line">        <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(prop &gt; min)</span></span><br><span class="line">        </span>&#123;</span><br><span class="line">            min = prop;</span><br><span class="line">            source = layoutComp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ComponentListPool.Release(components);</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸæ¥LayoutElementæœ‰ä¸€ä¸ªlayoutPriorityå±æ€§ç”¨æ¥å†³å®šä¼˜å…ˆçº§ï¼Œè¿™ä¸ªå±æ€§æš‚æ—¶è¿˜æ²¡æœ‰åœ¨ç¼–è¾‘å™¨ä¸­æš´éœ²ï¼Œä¹Ÿè®¸åç»­ç‰ˆæœ¬ä¼šåŠ å¼ºè¿™æ–¹é¢çš„èƒ½åŠ›ã€‚<br>AutoLayoutç³»ç»Ÿä¼šé€‰ç”¨ä¼˜å…ˆçº§æœ€é«˜çš„ILayoutElementé‡Œç›¸åº”å±æ€§è¿”å›ã€‚Imageå’ŒTextçš„ä¼˜å…ˆçº§é»˜è®¤æ˜¯0ï¼ŒLayoutElementé»˜è®¤ä¼˜å…ˆçº§æ˜¯1ã€‚æ‰€ä»¥æ­£å¸¸æƒ…å†µä¼šä½¿ç”¨LayoutElementä¸­çš„è®¾ç½®ï¼Œä½†æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒLayoutElementæ²¡æœ‰è®¾ç½®preferredHeightï¼ŒLayoutElementé‡Œå¸ƒå±€ç›¸å…³çš„åˆå§‹å€¼éƒ½æ˜¯-1ï¼Œæ‰€ä»¥è¿˜æ˜¯ä½¿ç”¨äº†Imageçš„preferredHeight:10ã€‚</p>
<p>ã€ç»“è¯­ã€‘<br>å…¶å®ï¼Œåªè¦å®˜æ–¹æ–‡æ¡£æè¿°è¯¦ç»†ä¸€äº›ï¼Œæ ¹æœ¬æ²¡å¿…è¦æµªè´¹æ—¶é—´å»æŸ¥è¿™ä¸ªæ¥é¾™å»è„‰ã€‚è¿™å‡ å¤©åœ¨å­¦ä¹ swiftï¼Œè‹¹æœäººæ€§åŒ–çš„Programming GuideåŠ ä¸ŠiReaderçš„é…åˆï¼Œä½¿å¾—å­¦ä¹ è¿™é—¨è¯­è¨€çœŸæ˜¯ä»¶è½»æ¾æ„‰å¿«çš„äº‹æƒ…ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒUnityç®€ç›´æ˜¯åœ¨è™å¾…å¼€å‘è€…ã€‚Unityã€Unrealã€Cryengineç­‰æœ€è¿‘ä¹Ÿä¸ºäº‰å¸‚åœºå¼„å¾—å¤´ç ´è¡€æµï¼Œé™¤äº†é™ä»·å¼€æºæä¾›æ–°ç‰¹æ€§ä¹‹å¤–ï¼Œå®Œå–„æ–‡æ¡£ã€é™ä½é—¨æ§›ä¹Ÿæ˜¯ä¸å®¹å¿½è§†çš„å·¥ä½œã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-06-30T15:25:43.000Z"><a href="/2015/06/30/Generics and Reflection/">Jun 30 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/06/30/Generics and Reflection/">C#.NETçš„æ³›å‹ä¸åå°„</a></h1>
  

    </header>
    <div class="entry">
      
        <h4 id="å¼•è¨€">å¼•è¨€</h4><p>åœ¨ä¹‹å‰ä¸åŒäº‹çš„è®¨è®ºä¸­å‘ç°å¯¹C#æ³›å‹åå°„æ—¶çš„ä¸€äº›æœ¯è¯­ç†è§£æœ‰äº›é”™è¯¯æˆ–è€…ä¸å¤Ÿæ·±åˆ»ï¼Œå€Ÿæ­¤æ–‡å¯¹ç›¸åº”çš„çŸ¥è¯†è¿›è¡Œä¸€ä¸‹æ•´ç†ã€‚æœ¬æ–‡åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸»è¦ç®€å•çš„ä»‹ç»ä¸€ä¸‹ â€œè¿è¡Œæ—¶ä¸­æ³›å‹â€ï¼Œç¬¬äºŒéƒ¨åˆ†å¯¹æ³›å‹åå°„çš„ä¸€äº›æœ¯è¯­è¿›è¡Œè§£é‡Šå¹¶å‚ç…§ä»£ç å’Œè¾“å‡ºç»“æœè¿›è¡Œåˆ†æå’Œå·©å›ºã€‚</p>
<h4 id="CLRä¸­çš„æ³›å‹">CLRä¸­çš„æ³›å‹</h4><p>åœ¨.NETä¸­å°†æ³›å‹ç±»å‹æˆ–è€…æ³›å‹æ–¹æ³•ç¼–è¯‘ä¸ºMSILæ—¶æ˜¯åŒ…å«æœ‰ç±»å‹å‚æ•°çš„å…ƒæ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨MSILå±‚é¢ï¼Œåªè´Ÿè´£æ³›å‹çš„å£°æ˜å’Œä½¿ç”¨ï¼Œè€Œæ³›å‹å®ä¾‹åŒ–æ˜¯ç”±CLRåœ¨è¿è¡Œæ—¶è´Ÿè´£å®Œæˆçš„ã€‚</p>
<p>æ³›å‹å£°æ˜ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Foo&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">    public void M1&lt;TU&gt;()</span><br><span class="line">    &#123;</span><br><span class="line">        // æ³›å‹çš„ä½¿ç”¨</span><br><span class="line">        var listOne = new List&lt;Int32&gt;();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(typeof(TU));</span><br><span class="line">        Console.WriteLine(typeof(T));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°æ³›å‹ç±»å°†è¢«ç¼–è¯‘æˆåå« Foo`1 &lt; T &gt; çš„æ³›å‹ç±»å‹ ,å…¶ M1&lt; TU &gt; æ³›å‹æ–¹æ³•å¯¹åº”çš„ILä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.method <span class="keyword">public</span> hidebysig instance <span class="keyword">void</span>  M1&lt;TU&gt;() cil managed</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ä»£ç å¤§å°       40 (0x28)</span></span><br><span class="line">  .maxstack  <span class="number">1</span></span><br><span class="line">  .<span class="function">locals <span class="title">init</span> <span class="params">([<span class="number">0</span>] class [mscorlib]System.Collections.Generic.List`<span class="number">1</span>&lt;int32&gt; listOne)</span></span><br><span class="line">  IL_0000:  nop</span><br><span class="line">  IL_0001:  newobj     instance <span class="keyword">void</span> class [mscorlib]System.Collections.Generic.List`1&lt;int32&gt;::.<span class="title">ctor</span><span class="params">()</span></span><br><span class="line">  IL_0006:  stloc.0</span><br><span class="line">  IL_0007:  ldtoken    !!TU</span><br><span class="line">  IL_000c:  call       class [mscorlib]System.Type [mscorlib]System.Type::<span class="title">GetTypeFromHandle</span><span class="params">(valuetype [mscorlib]System.RuntimeTypeHandle)</span></span><br><span class="line">  IL_0011:  call       <span class="keyword">void</span> [mscorlib]System.Console::<span class="title">WriteLine</span><span class="params">(<span class="keyword">object</span>)</span></span><br><span class="line">  IL_0016:  nop</span><br><span class="line">  IL_0017:  ldtoken    !T</span><br><span class="line">  IL_001c:  call       class [mscorlib]System.Type [mscorlib]System.Type::<span class="title">GetTypeFromHandle</span><span class="params">(valuetype [mscorlib]System.RuntimeTypeHandle)</span></span><br><span class="line">  IL_0021:  call       <span class="keyword">void</span> [mscorlib]System.Console::<span class="title">WriteLine</span><span class="params">(<span class="keyword">object</span>)</span></span><br><span class="line">  IL_0026:  nop</span><br><span class="line">  IL_0027:  ret</span><br><span class="line">&#125; <span class="comment">// end of method Foo`1::M1</span></span></span><br></pre></td></tr></table></figure>
<p>CLRä¼šæ ¹æ®è¿è¡Œæ—¶æä¾›çš„ç±»å‹å‚æ•°æ˜¯å€¼ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹è€Œä¸åŒï¼Œå¯¹äºå€¼ç±»å‹CLRå°†ä¼šä¸ºæ¯ä¸ªç±»å‹åˆ›å»º(ç¬¬ä¸€æ¬¡é‡åˆ°æ—¶)ä¸“ç”¨çš„æ³›å‹ç±»å‹ï¼Œå¯¹äºå¼•ç”¨ç±»å‹åˆ™ç•¥æœ‰ä¸åŒã€‚æ‰€æœ‰çš„å¼•ç”¨ç±»å‹éƒ½ä¼šé‡ç”¨åŒä¸€ä¸ªæ³›å‹ç‰ˆæœ¬ï¼Œå¤§ä½“ä¸Šå¯ä»¥æƒ³è±¡ä¸ºæ‰€æœ‰çš„å¼•ç”¨ç±»å‹ä½¿ç”¨ä¸€ä¸ª Object çš„æ³›å‹å®ä¾‹åŒ–ç‰ˆæœ¬ã€‚ä¹‹æ‰€ä»¥è¿™æ ·è®¾è®¡ï¼Œæ˜¯å› ä¸ºå¼•ç”¨çš„å¤§å°æ˜¯ç›¸åŒçš„(32ä½ç³»ç»Ÿä¸Šæ˜¯32ä½,64ä½ç³»ç»Ÿä¸Šæ˜¯64ä½)ï¼Œè€Œå€¼ç±»å‹åˆ™ä¸ç„¶ã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯å¯¹äºå¼•ç”¨ç±»å‹å¯ä»¥å…±äº«åŒä¸€ä»½native code, é¿å…â€œç±»å‹çˆ†ç‚¸â€ã€‚ï¼ˆå®ä¾‹åŒ–çš„æ³›å‹ç±»å‹è™½ç„¶äº«æœ‰ç‹¬ç«‹çš„å…ƒæ•°æ®ï¼Œä½†æ˜¯å…±äº«åŒä¸€ä¸ªEEClassï¼Œå³å…¶TypeHandleæŒ‡å‘çš„MethodTableä¸­çš„EEClassåœ°å€ç›¸åŒã€‚ï¼‰</p>
<h4 id="æ³›å‹ä¸åå°„">æ³›å‹ä¸åå°„</h4><h5 id="ä¸€äº›æœ¯è¯­">ä¸€äº›æœ¯è¯­</h5><ol>
<li><p>å¼€æ”¾æ³›å‹ç±»å‹/æ–¹æ³•ï¼ˆopen generic type/methodï¼‰ï¼šæ‰€æœ‰æ³›å‹å‚æ•°éƒ½æœªç»‘å®šå€¼çš„æ³›å‹ç±»å‹/æ–¹æ³•å®šä¹‰ï¼Œä¾‹å¦‚ï¼ŒDictionary&lt; TKey, TVal &gt;ã€‚</p>
</li>
<li><p>å¼€æ”¾æ„é€ ç±»å‹/æ–¹æ³•(open constructed type/method)ï¼šéƒ¨åˆ†æ³›å‹å‚æ•°ç»‘å®šäº†å…·ä½“ç±»å‹çš„å€¼çš„æ³›å‹ç±»å‹/æ–¹æ³•ï¼Œ ä¾‹å¦‚ï¼ŒDictionary&lt; String, TVal&gt;ã€‚</p>
</li>
<li><p>å°é—­æ„é€ ç±»å‹/æ–¹æ³•(close constructed type/method)ï¼šæŒ‰ç…§ ContainsGenericParameters=true æ¥å®šä¹‰ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š1ï¼‰å°é—­æ³›å‹ç±»å‹/æ–¹æ³•ï¼ˆclose generic type/methodï¼‰ï¼Œæ‰€æœ‰æ³›å‹å‚æ•°éƒ½ç»‘å®šäº†å…·ä½“ç±»å‹çš„å€¼çš„æ³›å‹ç±»å‹/æ–¹æ³•ï¼Œä¾‹å¦‚ï¼ŒDictionary&lt; String, Int32&gt;ï¼›2ï¼‰æ™®é€šçš„ç±»å‹/æ–¹æ³•ã€‚</p>
</li>
</ol>
<p><strong><em>æ³¨æ„ï¼šåœ¨æ³›å‹ç±»å‹ä¸Šå¯ä»¥è°ƒç”¨MakeGenericTypeç”Ÿæˆæ„é€ ç±»å‹ï¼Œåœ¨æ³›å‹æ–¹æ³•å®šä¹‰ä¸Šè°ƒç”¨MakeGenericMethodç”Ÿæˆæ„é€ æ–¹æ³•ã€‚ContainsGenericParameters å±æ€§æä¾›ä¸€ç§æ ‡å‡†æ–¹æ³•æ¥åŒºåˆ†å°é—­æ„é€ ç±»å‹/æ–¹æ³•ï¼ˆå¯ä»¥å®ä¾‹åŒ–/è°ƒç”¨ï¼‰å’Œå¼€æ”¾æ„é€ ç±»å‹/æ–¹æ³•ï¼ˆä¸èƒ½å®ä¾‹åŒ–/è°ƒç”¨ï¼‰ã€‚</em></strong></p>
<pre><code>ContainsGenericParameters å±æ€§é€’å½’æœç´¢ç±»å‹å‚æ•°
1ã€å¯¹äºå¼€æ”¾ç±»å‹ A<span class="tag">&lt; <span class="attribute">T</span>&gt;</span> ä¸Šçš„æ‰€æœ‰æ–¹æ³•è°ƒç”¨ ContainsGenericParameters éƒ½å°†è¿”å›trueï¼›
2ã€å¯¹äºä¸‹é¢ä»£ç ä¸­çš„ listOfSomeUnknownTypeOfList ç±»å‹ï¼Œç”±äº g1æ˜¯ å¼€æ”¾æ³›å‹ç±»å‹æ‰€ä»¥listOfSomeUnknownTypeOfList.ContainsGenericParameters è¿”å› trueã€‚

<span class="comment"><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gl = <span class="keyword">typeof</span>(List&lt;&gt;);</span><br><span class="line"><span class="keyword">var</span> listOfSomeUnknownTypeOfList = gl.MakeGenericType(gl);</span><br></pre></td></tr></table></figure></span>
</code></pre><ol>
<li><p>æ³›å‹ç±»å‹ï¼šåŒ…æ‹¬å¼€æ”¾æ³›å‹ç±»å‹ã€å¼€æ”¾æ„é€ ç±»å‹ã€å°é—­æ³›å‹ç±»å‹</p>
</li>
<li><p>æ³›å‹æ–¹æ³•ï¼šåŒ…æ‹¬å¼€æ”¾æ³›å‹æ–¹æ³•ã€å¼€æ”¾æ„é€ æ–¹æ³•ï¼ˆæ³¨ï¼šä¸åŒ…æ‹¬å¼€æ”¾æ³›å‹ç±»å‹ã€å¼€æ”¾æ„é€ ç±»å‹ä¸­çš„éæ³›å‹å¼€æ”¾æ„é€ æ–¹æ³•ï¼Œè§åé¢ â€œå¼€æ”¾æ³›å‹ç±»å‹ï¼ˆåŠå¼€æ”¾æ„é€ ç±»å‹ï¼‰ä¸Šçš„æ–¹æ³•åå°„â€ éƒ¨åˆ†å†…å®¹ï¼‰ã€å°é—­æ³›å‹æ–¹æ³•</p>
</li>
</ol>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2015/06/30/Generics and Reflection/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-04-24T11:14:21.000Z"><a href="/2015/04/24/closures/">Apr 24 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/04/24/closures/">é—­åŒ…(closures)</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1-_æ‘˜è¦">1. æ‘˜è¦</h3><p>ä¸€ç›´ä»¥æ¥ï¼Œé—­åŒ…è¿™ç§ç¼–ç¨‹ç»“æ„éƒ½æ˜¯ä¸€äº›è¯­è¨€çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚åœ¨æŸäº›åœºæ™¯ä¸­ä½¿ç”¨é—­åŒ…èƒ½å¤Ÿä¼˜é›…åœ°è§£å†³ä¸€äº›æ£˜æ‰‹çš„é—®é¢˜ã€‚åŒæ—¶é—­åŒ…çš„ä½¿ç”¨æœ‰ç›Šäºæ¨¡å—åŒ–ç¼–ç¨‹ï¼Œå®ƒèƒ½ä»¥ç®€å•çš„æ–¹å¼å¼€å‘è¾ƒå°çš„æ¨¡å—ï¼Œä»è€Œæé«˜å¼€å‘é€Ÿåº¦å’Œç¨‹åºçš„å¯å¤ç”¨æ€§ã€‚</p>
<p>é—­åŒ…æ˜¯ä¸€é—¨ååˆ†æœ‰ç”¨çš„æŠ€æœ¯ï¼Œä½†æ˜¯ç”±äºåœ¨C#ä¸­å‡½æ•°ä¸æ˜¯ä¸€ç­‰å…¬æ°‘ï¼ˆFirst-class citizenï¼‰çš„åŸå› ï¼Œä»¥å‰åœ¨ä½¿ç”¨C#çš„æ—¶å€™æˆ‘æ²¡æœ‰æ·±å…¥åœ°å»å…³æ³¨å…¶ä¸­å¯¹é—­åŒ…çš„æ”¯æŒã€‚è€Œæœ€è¿‘ä¸€æ®µæ—¶é—´ç”±äºå·¥ä½œéœ€è¦ï¼Œä¸»è¦ä½¿ç”¨ javascript/python è¿›è¡Œå¼€å‘ï¼Œåœ¨è¿™ä¸¤ç§ç¼–ç¨‹è¯­è¨€ä¸­å‡½æ•°éƒ½æ˜¯è¢«è§†ä¸ºä¸€ç­‰å¯¹è±¡ï¼Œå®è·µä¸­å¤§é‡ä½¿ç”¨é—­åŒ…ç®€åŒ–ç¼–ç¨‹ã€‚ä¾‹å¦‚åœ¨javascriptä¸­ä½¿ç”¨é—­åŒ…æ¨¡æ‹Ÿå¯¹è±¡å®ä¾‹ï¼Œåœ¨pythonä¸­åˆ©ç”¨é—­åŒ…çš„ç‰¹æ€§å®šä¹‰åŠŸèƒ½å¼ºå¤§çš„è£…é¥°å™¨ç­‰ç­‰ã€‚</p>
<p>å¯¹äºè¿™æ ·ä¸€é—¨æŠ€æœ¯ï¼Œä»…ä»…ä¼šä½¿ç”¨ä¸æ˜¯ç›®çš„ï¼ŒçŸ¥å…¶ç„¶è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶æ‰æ˜¯ã€‚è¿™ç¯‡ç¬”è®°å³æ˜¯å‡ºäºè¿™æ ·ä¸€ç§ç›®çš„è€Œæ•´ç†çš„ã€‚ç›¸æ¯”è¾ƒè€Œè¨€æˆ‘åªå¯¹C#ã€javascriptã€pythonæ¯”è¾ƒç†Ÿæ‚‰ï¼Œè€Œä¸‰è€…ä¸­javascriptå¯¹é—­åŒ…çš„æ”¯æŒç›¸å¯¹çº¯ç²¹å’Œå®Œå¤‡ï¼Œæ‰€ä»¥ç¬”è®°ä¸­æˆ‘ä¸»è¦ç”¨javascriptè¯­è¨€è¡¨è¿°ã€‚ä½†æ˜¯æ¶‰åŠå…·ä½“è¯­è¨€çš„éƒ¨åˆ†ï¼Œä¹Ÿä½¿ç”¨C#å’Œpythonè¯­è¨€è¡¨è¿°ï¼Œæ¯”å¦‚å¯¹ â€œé—­åŒ…é™·é˜±â€ çš„è§£å†³ï¼Œpythonå—é™åˆ¶çš„é—­åŒ…å®ç°ã€‚</p>
<p>æ³¨ï¼šç¬”è®°ç›¸å…³çš„ä»£ç ï¼Œä¸»è¦çš„ç›®çš„æ˜¯æè¿°é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘å¹¶æ²¡æœ‰ä¸€ä¸€è¿è¡Œè¿‡ï¼Œä¸èƒ½ç¡®ä¿éƒ½æ˜¯æ­£ç¡®çš„ã€‚ä½†è¿™ä¸å½±å“ç›¸å…³å†…å®¹ã€‚</p>
<h3 id="2-_é—­åŒ…ï¼ŒåŒ¿åå‡½æ•°ï¼Œå‡½æ•°å¯¹è±¡ï¼Œè‡ªç”±å˜é‡ï¼Œå¥½ä¹±çš„æ ·å­">2. é—­åŒ…ï¼ŒåŒ¿åå‡½æ•°ï¼Œå‡½æ•°å¯¹è±¡ï¼Œè‡ªç”±å˜é‡ï¼Œå¥½ä¹±çš„æ ·å­</h3><p>åœ¨ï¼ˆä¸€èˆ¬çš„ï¼‰ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸä»…é™äºåŒ…å«å®ƒä»¬çš„å‡½æ•°ï¼Œè„±ç¦»äº†åˆ›å»ºå®ƒçš„å‡½æ•°ç¯å¢ƒåä¾¿æ— æ³•è¢«è®¿é—®åˆ°ã€‚ä½†åœ¨ä¸€äº›æ”¯æŒåµŒå¥—å®šä¹‰å‡½æ•°çš„è¯­è¨€ä¸­ï¼Œå¦‚æœå†…éƒ¨çš„å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨çš„å‡½æ•°çš„å˜é‡ï¼Œåˆ™å¯èƒ½å»¶é•¿å˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¾‹å¦‚ä¸‹é¢çš„javascriptä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = x * <span class="number">2</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span><span class="params">(y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i+y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f1 = foo(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> f2 = foo(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">print(f1(<span class="number">2</span>)); <span class="comment">// 4</span></span><br><span class="line">print(f2(<span class="number">2</span>)); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<p>å¤–éƒ¨ foo å‡½æ•°æ‰§è¡Œåè¿”å›äº†fooå†…éƒ¨å®šä¹‰çš„åŒ¿åå‡½æ•°ï¼Œä»¥åŠä¸åœ¨è¯¥å†…éƒ¨å‡½æ•°ä¸­å®šä¹‰çš„å¤–éƒ¨å˜é‡iã€‚å³ä½¿ç¦»å¼€äº†åˆ›å»ºiçš„å‡½æ•°ç¯å¢ƒï¼Œæˆ‘ä»¬ä¾ç„¶èƒ½å¤Ÿé€šè¿‡f1ï¼Œf2è®¿é—®åˆ°iã€‚è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„é—­åŒ…ï¼ˆClosureï¼‰ã€‚</p>
<p>å…¶å®é—­åŒ…å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œè€Œæ˜¯æ—©åœ¨ä¸Šä¸ªä¸–çºª60å¹´ä»£é«˜çº§è¯­è¨€å‘å±•åˆæœŸå°±å·²ç»äº§ç”Ÿã€‚é‚£ä¹ˆç©¶ç«Ÿé—­åŒ…æ˜¯ä»€ä¹ˆå‘¢ï¼ŸæŒ‰ç…§ç»´åŸºç™¾ç§‘é—­åŒ…çš„è§£é‡Šï¼Œä¸€èˆ¬æˆ‘ä»¬æœ‰ä¸¤ç§å®šä¹‰ï¼š</p>
<ol>
<li><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œé—­åŒ…ï¼ˆClosureï¼‰æ˜¯è¯æ³•é—­åŒ…ï¼ˆLexical Closureï¼‰çš„ç®€ç§°ï¼ŒæŒ‡çš„æ˜¯å¼•ç”¨äº†è‡ªç”±å˜é‡çš„å‡½æ•°ï¼ˆ<em>è‡ªç”±å˜é‡æŒ‡å®šçš„é™¤å»å‡½æ•°å±€éƒ¨å˜é‡ä¹‹å¤–çš„å…¶ä»–å˜é‡ï¼Œæ¯”å¦‚å‰é¢ä¾‹å­ä¸­çš„å˜é‡i</em>ï¼‰ã€‚</p>
</li>
<li><p>å¦ä¸€ç§è¯´æ³•è®¤ä¸ºé—­åŒ…æ˜¯ç”±å‡½æ•°å’Œç›¸å…³çš„å¼•ç”¨ç¯å¢ƒç»„åˆè€Œæˆçš„å®ä½“ã€‚</p>
</li>
</ol>
<p>ä»å®šä¹‰ä¸Šå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ç§å¯¹é—­åŒ…çš„å®šä¹‰å…·æœ‰å®Œå…¨ä¸åŒçš„å…³æ³¨ç‚¹ã€‚å¯¹äºç¬¬ä¸€ç§å®šä¹‰ï¼Œå¼ºè°ƒçš„æ˜¯é—­åŒ…æ˜¯å‡½æ•°ï¼Œæ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ã€‚ç¬¬äºŒç§å®šä¹‰è®¤ä¸ºé—­åŒ…æ˜¯å‡½æ•°å’Œå¼•ç”¨ç¯å¢ƒç»„æˆçš„å®ä½“ï¼Œæœ¬è´¨ä¸Šä¸å†æ˜¯å‡½æ•°ï¼Œè€Œæ˜¯å‡½æ•°å¯¹è±¡ï¼Œèƒ½å¤Ÿä½œä¸ºå¯¹è±¡ä½¿ç”¨çš„å‡½æ•°ã€‚æœ¯è¯­ <strong>first class function</strong> æ˜¯å¯¹è¿™ä¸ªæ¦‚å¿µçš„ç²¾ç¡®æè¿°ã€‚å‡½æ•°æœ¬è´¨ä¸Šåªæ˜¯ä¸€äº›å¯æ‰§è¡Œçš„ä»£ç ï¼Œä¸€æ—¦è¢«å®šä¹‰å¥½ä»¥åå°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰çŠ¶æ€ï¼Œå…·æœ‰å¼•ç”¨çš„é€æ˜æ€§ã€‚é—­åŒ…ä½œä¸ºå‡½æ•°å¯¹è±¡ï¼Œå¯ä»¥ç”±åŒä¸€ä¸ªå‡½æ•°ä¸ä¸åŒçš„å¼•ç”¨ç¯å¢ƒç»„æˆä¸åŒçš„å®ä¾‹ï¼Œæœ‰çŠ¶æ€ï¼Œæ²¡æœ‰å¼•ç”¨çš„é€æ˜æ€§ï¼Œæ‰€ä»¥é—­åŒ…ä¸å†æ˜¯å•çº¯çš„å‡½æ•°ã€‚</p>
<p>ä»ç†è§£çš„è§’åº¦çš„æ¥è¯´ï¼Œç¬¬äºŒç§å®šä¹‰æ›´ä¸ºç²¾ç¡®å’Œåˆ©äºç†è§£ã€‚</p>
<p><strong><em>æ³¨ï¼šåŒ¿åå‡½æ•°ä¸é—­åŒ…æ˜¯ä¸åŒæ¦‚å¿µï¼Œåœ¨ä¸€èˆ¬æ”¯æŒé—­åŒ…çš„è¯­è¨€ä¸­éƒ½æ”¯æŒåŒ¿åå‡½æ•°ï¼ŒåŒ¿åå‡½æ•°å¯ä»¥è®©æˆ‘ä»¬æ›´å®¹æ˜“å®ç°é—­åŒ…ã€‚</em></strong></p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2015/04/24/closures/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-04-22T13:04:01.000Z"><a href="/2015/04/22/IOLOOP/">Apr 22 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/04/22/IOLOOP/">tornadoï¼šIOLoopæ¨¡å—è§£æ</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="æ‘˜è¦">æ‘˜è¦</h3><p><a href="https://github.com/tornadoweb/tornado/blob/v4.0.2/tornado/ioloop.py#L17"><em> </em> <em> <code>ioloop.py</code> </em> <em> </em></a> æ˜¯æ•´ä¸ªtornadoçš„æ ¸å¿ƒæ¨¡å—ï¼Œè´Ÿè´£å®ç°æœåŠ¡å™¨çš„å¼‚æ­¥éé˜»å¡æœºåˆ¶ã€‚å…¶ä¸­<a href="https://github.com/tornadoweb/tornado/blob/v4.0.2/tornado/ioloop.py#L70"><strong> <code>IOLoop</code> </strong></a>ç±»æ˜¯ä¸€ä¸ªåŸºäºlevel-triggeredçš„I/Oäº‹ä»¶å¾ªç¯ï¼Œå®ƒä½¿ç”¨I/Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼ˆselectæ¨¡å‹ï¼‰ç›‘è§†æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„I/Oäº‹ä»¶æ˜¯å¦å°±ç»ªï¼Œå½“æ–‡ä»¶æè¿°ç¬¦I/Oäº‹ä»¶å°±ç»ªåè°ƒç”¨å¯¹åº”çš„å¤„ç†å™¨ï¼ˆhandlerï¼‰è¿›è¡Œå¤„ç†ã€‚æœ¬ç¯‡ç¬”è®°æ˜¯å¯¹tornado v4.0.3çš„ IOLoopæ¨¡å—çš„æºç è§£æã€‚</p>
<h3 id="IOLoop">IOLoop</h3><p>IOLoopåœ¨Linuxä¸‹ä½¿ç”¨<code>epoll</code>, åœ¨BSD/Mac OS Xä¸‹ä½¿ç”¨<code>kqueue</code>ï¼Œå¦åˆ™ä½¿ç”¨<code>selelct</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="decorator">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">configurable_default</span><span class="params">(cls)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> hasattr(select, <span class="string">"epoll"</span>):</span><br><span class="line">        <span class="keyword">from</span> tornado.platform.epoll <span class="keyword">import</span> EPollIOLoop</span><br><span class="line">        <span class="keyword">return</span> EPollIOLoop</span><br><span class="line">    <span class="keyword">if</span> hasattr(select, <span class="string">"kqueue"</span>):</span><br><span class="line">        <span class="comment"># Python 2.6+ on BSD or Mac</span></span><br><span class="line">        <span class="keyword">from</span> tornado.platform.kqueue <span class="keyword">import</span> KQueueIOLoop</span><br><span class="line">        <span class="keyword">return</span> KQueueIOLoop</span><br><span class="line">    <span class="keyword">from</span> tornado.platform.select <span class="keyword">import</span> SelectIOLoop</span><br><span class="line">    <span class="keyword">return</span> SelectIOLoop</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è°ƒç”¨<a href="https://github.com/tornadoweb/tornado/blob/v4.0.2/tornado/ioloop.py#L674"><code>add_handler</code></a>æ–¹æ³•å°†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦(v4.0ä¸­å¢åŠ äº†å¯¹file-like objectçš„æ”¯æŒ)åŠ å…¥åˆ°I/Oäº‹ä»¶å¾ªç¯ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_handler</span><span class="params">(self, fd, handler, events)</span>:</span></span><br><span class="line">    <span class="string">"""Registers the given handler to receive the given events for ``fd``.</span><br><span class="line"></span><br><span class="line">    The ``fd`` argument may either be an integer file descriptor or</span><br><span class="line">    a file-like object with a ``fileno()`` method (and optionally a</span><br><span class="line">    ``close()`` method, which may be called when the `IOLoop` is shut</span><br><span class="line">    down).</span><br><span class="line"></span><br><span class="line">    The ``events`` argument is a bitwise or of the constants</span><br><span class="line">    ``IOLoop.READ``, ``IOLoop.WRITE``, and ``IOLoop.ERROR``.</span><br><span class="line"></span><br><span class="line">    When an event occurs, ``handler(fd, events)`` will be run.</span><br><span class="line"></span><br><span class="line">    .. versionchanged:: 4.0</span><br><span class="line">       Added the ability to pass file-like objects in addition to</span><br><span class="line">       raw file descriptors.</span><br><span class="line">    """</span></span><br><span class="line"></span><br><span class="line">    fd, obj = self.split_fd(fd)</span><br><span class="line">    self._handlers[fd] = (obj, stack_context.wrap(handler))</span><br><span class="line">    self._impl.register(fd, events | self.ERROR)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2015/04/22/IOLOOP/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-04-22T08:44:17.000Z"><a href="/2015/04/22/IO-strategies-server/">Apr 22 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/04/22/IO-strategies-server/">åŸºäºä¸åŒI/Oç­–ç•¥çš„æœåŠ¡å™¨æ¨¡å‹</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="æ‘˜è¦">æ‘˜è¦</h3><p>å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ç¼–å†™çš„ï¼ˆWebï¼‰æœåŠ¡ç«¯ç¨‹åºï¼Œéƒ½æ˜¯åŸºäºå·²æœ‰çš„ç½‘ç»œæœåŠ¡æ¡†æ¶æˆ–è€…æœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡ç«¯ç¨‹åºçš„å…³æ³¨ç‚¹ä¸»è¦æ˜¯å¤„ç†é¢†åŸŸä¸šåŠ¡ï¼Œå¾ˆå°‘ç›´æ¥æ¶‰åŠåˆ°å¦‚ä½•é«˜æ•ˆç¨³å®šå¤„ç†ä¸å®¢æˆ·ç«¯çš„é€šä¿¡é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå½“ä½ éœ€è¦ä»æœåŠ¡ç«¯æ‰“å¾—ç«çƒ­çš„å„ç§æ¡†æ¶ä¸­é€‰æ‹©ä¸€ä¸ªæ¥å¼€å‘åº”ç”¨ç¨‹åºï¼Œå½“ä½ éœ€è¦ä¿®æ”¹ç°æœ‰æ¡†æ¶æˆ–ä¼˜åŒ–ç°æœ‰åº”ç”¨ï¼Œå½“ä½ éœ€è¦æ„å»ºä¸€ä¸ªéWebç½‘ç»œæœåŠ¡ç¨‹åºï¼Œç”šè‡³å½“ä½ éœ€è¦ä»0åˆ°1ç¼–å†™ä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨æ—¶ï¼Œè¿™äº›çŸ¥è¯†å’Œç»éªŒè¿˜è¿œè¿œä¸å¤Ÿã€‚</p>
<p>å¯¹äºç½‘ç»œæœåŠ¡å™¨ç¨‹åºæ¥è¯´ï¼Œå¦‚ä½•å¤„ç†å®¢æˆ·ç«¯è¿æ¥æ˜¯å…¶å‰æå’ŒåŸºç¡€ï¼Œèƒ½å¤Ÿç¨³å®šåœ°å¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥æ˜¯æœåŠ¡å™¨ç¨‹åºæœ€é‡è¦çš„æ€§èƒ½æŒ‡æ ‡ã€‚ç”±äºæ“ä½œç³»ç»Ÿä»»åŠ¡å¤„ç†å’ŒI/Oæ¨¡å‹çš„é™åˆ¶ï¼Œæˆ‘ä»¬å¯ç”¨çš„ç½‘ç»œæœåŠ¡å™¨æ¨¡å‹æ˜¯æœ‰é™çš„ã€‚ä¸åŒçš„æœåŠ¡æ¨¡å‹å¯ä»¥åº”å¯¹ä¸åŒçš„ç¯å¢ƒï¼Œå…·æœ‰ä¸åŒçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</p>
<p>ä»æ“ä½œç³»ç»Ÿä»»åŠ¡å¤„ç†çš„è§’åº¦æ¥çœ‹ï¼Œæœ‰ä¸‰ç§æœåŠ¡å™¨æ¨¡å‹å¯é€‰ï¼š</p>
<ul>
<li>å¤šè¿›ç¨‹æ¨¡å‹</li>
<li>å¤šçº¿ç¨‹æ¨¡å‹</li>
<li>ï¼ˆå•çº¿ç¨‹ï¼‰å¼‚æ­¥æ¨¡å‹</li>
</ul>
<p>ä»¥ä¸Šæ¨¡å‹çš„ç‰¹ç‚¹åŠå…¶åº”ç”¨ï¼Œå¯ä»¥å‚è€ƒä¸€äº›WebæœåŠ¡å™¨çš„è®¾è®¡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚åç»­ä¼šæœ‰ç›¸å…³çš„ç¬”è®°è¿›è¡Œç¨å¾®æ·±å…¥çš„è®¨è®ºã€‚</p>
<p>ä½¿ç”¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹ï¼Œå…¶å·®å¼‚ä¸»è¦åœ¨äºè¿›ç¨‹å’Œçº¿ç¨‹çš„ç‰¹æ€§ï¼Œæ‰€ä»I/Oæ¨¡å‹è§’åº¦æè¿°æ—¶æˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹æ¥æè¿°ã€‚ä»I/Oæ¨¡å‹çš„è§’åº¦æ¥çœ‹ï¼Œæœ€å¸¸ç”¨çš„ç½‘ç»œæœåŠ¡å™¨æ¨¡å‹æœ‰ï¼š</p>
<ul>
<li>å•çº¿ç¨‹é˜»å¡I/Oæ¨¡å‹</li>
<li>å¤šçº¿ç¨‹é˜»å¡I/Oæ¨¡å‹</li>
<li>å•çº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹ï¼ˆåŒ…æ‹¬éé˜»å¡I/O,I/Oå¤ç”¨ï¼‰</li>
<li>å•çº¿ç¨‹å¼‚æ­¥I/Oæ¨¡å‹</li>
</ul>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2015/04/22/IO-strategies-server/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-04-22T07:35:16.000Z"><a href="/2015/04/22/mutiplexing-IO/">Apr 22 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/04/22/mutiplexing-IO/">I/O å¤ç”¨ï¼šselectã€pollå’Œepoll</a></h1>
  

    </header>
    <div class="entry">
      
        <h4 id="å¼•è¨€">å¼•è¨€</h4><p>åœ¨<strong>é˜»å¡å¼I/</strong>Oæ¨¡å‹ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½å¤„ç†ä¸€ä¸ªæµçš„I/Oäº‹ä»¶ï¼Œä¸ºäº†åŒæ—¶é«˜æ•ˆå¤„ç†å¤šä¸ªæµï¼Œåªèƒ½é‡‡ç”¨å¤šè¿›ç¨‹ï¼ˆforkï¼‰æˆ–è€…å¤šçº¿ç¨‹çš„æ–¹å¼ã€‚</p>
<p>ä½¿ç”¨<strong>éé˜»å¡I/O</strong>æ¨¡å‹ï¼Œå¯ä»¥é€šè¿‡å¾ªç¯éå†çš„æ–¹å¼åŒæ—¶å¤„ç†å¤šä¸ªæµï¼ˆå¿™è½®è¯¢ï¼‰ï¼Œä½†æ˜¯å¦‚æœæ‰€æœ‰æµéƒ½æ²¡æœ‰æ•°æ®ï¼Œå°±ä¼šé€ æˆCPUçš„æµªè´¹ï¼ˆåœ¨ä¸€äº›æœåŠ¡ç«¯åº”ç”¨ç¨‹åºä¸Šä¾¿ä¸é«˜æ•ˆï¼‰ã€‚</p>
<p>ä¸ºäº†é¿å…CPUçš„æµªè´¹ï¼Œå¼•å…¥ä¸€ä¸ªä»£ç†ï¼ˆ<strong>select/pollï¼ŒI/Oå¤ç”¨</strong>ï¼‰ï¼Œè¿™ä¸ªä»£ç†èƒ½å¤ŸåŒæ—¶ç›‘è§†å¤šä¸ªæµçš„äº‹ä»¶ï¼Œå½“æ²¡æœ‰æµäº‹ä»¶å‘ç”Ÿæ—¶é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œé‡Šæ”¾CPUèµ„æºã€‚</p>
<p>è™½ç„¶select/pollèƒ½å¤ŸåŒæ—¶ç›‘è§†å¤šä¸ªæµï¼ˆæè¿°ç¬¦ï¼‰äº‹ä»¶ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“å…·ä½“æ˜¯å“ªä¸€ä¸ªæµçš„äº‹ä»¶å‘ç”Ÿï¼Œå…¶å®ç°æ˜¯éå†æ‰€æœ‰çš„æè¿°ç¬¦ï¼Œæ•…ç§°ä¸ºæ— å·®åˆ«è½®è¯¢ã€‚éšç€ç›‘è§†çš„æè¿°ç¬¦å¢å¤šï¼Œæ€§èƒ½ä¼šä¸‹é™ï¼Œå¹¶ä¸”æœ‰äº›ç³»ç»Ÿå®ç°é‡Œé¢å•ä¸ªè¿›ç¨‹ç›‘è§†çš„æè¿°ç¬¦æ•°é‡æ˜¯æœ‰æœ€å¤§é™åˆ¶çš„ã€‚</p>
<p>æ‰€ä»¥æœ‰äº†epollï¼ˆlinuxï¼‰/kqueueï¼ˆfreebsdï¼‰/iocpï¼ˆwindowsï¼‰çš„å‡ºç°ï¼Œä¸åŒäºéé˜»å¡å¼I/Oçš„å¿™è½®è¯¢å’ŒI/Oå¤ç”¨çš„æ— å·®åˆ«è½®è¯¢ï¼Œepollåªåœ¨æŸä¸ªæµäº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥è°ƒç”¨è€…ï¼ˆå†…æ ¸å®ç°ï¼‰ã€‚</p>
<h4 id="select">select</h4><p>è°ƒç”¨selectå‘Šè¯‰å†…æ ¸å¯¹é‚£äº›æè¿°ç¬¦ï¼ˆå°±è¯»ã€å†™æˆ–å¼‚å¸¸æ¡ä»¶ï¼‰æ„Ÿå…´è¶£ä»¥åŠç­‰å¾…å¤šé•¿æ—¶é—´ã€‚æ„Ÿå…´è¶£çš„æè¿°ç¬¦ä¸å±€é™äºå¥—æ¥å­—ï¼Œä»»ä½•æè¿°ç¬¦éƒ½å¯ä»¥ä½¿ç”¨selectæ¥æµ‹è¯•ã€‚ä»¥ä¸‹ä¸ºselectçš„å‡½æ•°ç­¾åï¼š</p>
<img src="/2015/04/22/mutiplexing-IO/select.png">
<p>select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯readfdsã€writefdså’Œexceptfdsï¼ˆéƒ½æ˜¯å€¼-ç»“æœå‚æ•°ï¼‰ã€‚è°ƒç”¨åselectå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªï¼ˆæœ‰æ•°æ®å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰å¼‚å¸¸ï¼‰æˆ–è€…è¶…æ—¶ï¼ˆtimeoutæŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œ <del>å¦‚æœç«‹å³è¿”å›è®¾ä¸ºnullå³å¯</del>ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥ é€šè¿‡éå†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚</p>
<p>timeoutå‘ŠçŸ¥å†…æ ¸ç­‰å¾…æ‰€æŒ‡å®šçš„æè¿°ç¬¦ä¸­çš„ä»»ä½•ä¸€ä¸ªå°±ç»ªå¯èŠ±å¤šé•¿æ—¶é—´ã€‚å…¶timevalç»“æ„ç”¨äºæŒ‡å®šè¿™æ®µæ—¶é—´çš„ç§’æ•°å’Œå¾®å¦™æ•°ï¼ˆè™½ç„¶å…è®¸æŒ‡å®šï¼Œå®é™…ä¸Šç”±äºæ“ä½œç³»ç»Ÿå†…æ ¸å®ç°çš„åŸå› è¿™ä¸ªå¾®ç§’çº§çš„åˆ†è¾¨ç‡å®é™…ä¸Šå¹¶ä¸å¾ˆç²¾ç¡®ï¼‰ã€‚<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2015/04/22/mutiplexing-IO/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  

  <nav id="pagination">
  
  
    <a href="/archives/page/2/" class="alignright next">ä¸‹ä¸€é </a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="æœå°‹">
    <input type="hidden" name="q" value="site:blog.jidanke.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">åˆ†é¡</h3>
  <ul class="entry">
  
    <li><a href="/categories/C-åŸºç¡€/">C#åŸºç¡€</a><small>1</small></li>
  
    <li><a href="/categories/Unity3D/">Unity3D</a><small>13</small></li>
  
    <li><a href="/categories/python/">python</a><small>1</small></li>
  
    <li><a href="/categories/tornado/">tornado</a><small>1</small></li>
  
    <li><a href="/categories/æœåŠ¡ç«¯åŸºç¡€/">æœåŠ¡ç«¯åŸºç¡€</a><small>3</small></li>
  
    <li><a href="/categories/ç¼–ç¨‹åŸºç¡€/">ç¼–ç¨‹åŸºç¡€</a><small>1</small></li>
  
    <li><a href="/categories/è®¡ç®—æœºå›¾å½¢/">è®¡ç®—æœºå›¾å½¢</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">æ¨™ç±¤</h3>
  <ul class="entry">
  
    <li><a href="/tags/Animator/">Animator</a><small>3</small></li>
  
    <li><a href="/tags/AutoLayout/">AutoLayout</a><small>1</small></li>
  
    <li><a href="/tags/C/">C#</a><small>2</small></li>
  
    <li><a href="/tags/C10K/">C10K</a><small>1</small></li>
  
    <li><a href="/tags/CLR/">CLR</a><small>1</small></li>
  
    <li><a href="/tags/Debug/">Debug</a><small>1</small></li>
  
    <li><a href="/tags/Glider/">Glider</a><small>1</small></li>
  
    <li><a href="/tags/I-O-mutiplexing/">I/O mutiplexing</a><small>1</small></li>
  
    <li><a href="/tags/I-Oå¤ç”¨/">I/Oå¤ç”¨</a><small>1</small></li>
  
    <li><a href="/tags/MRO/">MRO</a><small>1</small></li>
  
    <li><a href="/tags/MVC/">MVC</a><small>1</small></li>
  
    <li><a href="/tags/Physics2D/">Physics2D</a><small>1</small></li>
  
    <li><a href="/tags/Sublime/">Sublime</a><small>1</small></li>
  
    <li><a href="/tags/UI/">UI</a><small>1</small></li>
  
    <li><a href="/tags/UNIX-I-O/">UNIX I/O</a><small>1</small></li>
  
    <li><a href="/tags/dict/">__dict__</a><small>1</small></li>
  
    <li><a href="/tags/slots/">__slots__</a><small>1</small></li>
  
    <li><a href="/tags/asynchronous/">asynchronous</a><small>1</small></li>
  
    <li><a href="/tags/blocking/">blocking</a><small>2</small></li>
  
    <li><a href="/tags/closures/">closures</a><small>1</small></li>
  
    <li><a href="/tags/descriptor/">descriptor</a><small>1</small></li>
  
    <li><a href="/tags/epoll/">epoll</a><small>3</small></li>
  
    <li><a href="/tags/first-class/">first-class</a><small>1</small></li>
  
    <li><a href="/tags/ioloop/">ioloop</a><small>1</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>1</small></li>
  
    <li><a href="/tags/kqueue/">kqueue</a><small>1</small></li>
  
    <li><a href="/tags/lua/">lua</a><small>1</small></li>
  
    <li><a href="/tags/nonblocking/">nonblocking</a><small>2</small></li>
  
    <li><a href="/tags/poll/">poll</a><small>3</small></li>
  
    <li><a href="/tags/python/">python</a><small>3</small></li>
  
    <li><a href="/tags/select/">select</a><small>3</small></li>
  
    <li><a href="/tags/synchronous/">synchronous</a><small>1</small></li>
  
    <li><a href="/tags/tornado/">tornado</a><small>1</small></li>
  
    <li><a href="/tags/uGUI/">uGUI</a><small>1</small></li>
  
    <li><a href="/tags/å‡½æ•°å¯¹è±¡/">å‡½æ•°å¯¹è±¡</a><small>1</small></li>
  
    <li><a href="/tags/åŒ¿åå‡½æ•°/">åŒ¿åå‡½æ•°</a><small>1</small></li>
  
    <li><a href="/tags/åå°„/">åå°„</a><small>1</small></li>
  
    <li><a href="/tags/æœåŠ¡å™¨æ¨¡å‹/">æœåŠ¡å™¨æ¨¡å‹</a><small>1</small></li>
  
    <li><a href="/tags/æ³›å‹/">æ³›å‹</a><small>1</small></li>
  
    <li><a href="/tags/è‡ªç”±å˜é‡/">è‡ªç”±å˜é‡</a><small>1</small></li>
  
    <li><a href="/tags/è§„èŒƒ/">è§„èŒƒ</a><small>1</small></li>
  
    <li><a href="/tags/è®¡ç®—æœºå›¾å½¢/">è®¡ç®—æœºå›¾å½¢</a><small>1</small></li>
  
    <li><a href="/tags/é—­åŒ…/">é—­åŒ…</a><small>1</small></li>
  
    <li><a href="/tags/é˜»å¡/">é˜»å¡</a><small>1</small></li>
  
    <li><a href="/tags/éé˜»å¡/">éé˜»å¡</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 JiDanKe
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>